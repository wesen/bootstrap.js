<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Search Service Tool</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/jsondiffpatch.html.css" rel="stylesheet">
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
    </div>

    <div class="container" id="main">
    </div>

    <script id="alert-template" type="text/x-handlebars-template">
      <div class="alert {{class}} {{#if type}}alert-{{type}}{{/if}}">
        {{#unless popup}}<a class="close" data-dismiss="alert">×</a>{{/unless}}
        {{#if title}}<strong>{{title}}</strong>{{/if}}
        {{message}}
      </div>
    </script>

    <script id="navigation-template" type="text/x-handlebars-template">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Search Service</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li class="active"><a href="#diff">Diff</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </script>
    
    <script id="main-template" type="text/x-handlebars-template">
      <div class="row show-grid">
        <div class="span4">
          <div id="searchView">
          </div>
          <div id="filterView">
          </div>
        </div>
        <div class="span8">
          <div class="row">
            <div id="filterListView" class="span8">
            </div>
          </div>
          <div class="row">
            <div id="resultView" class="span8">
            </div>
          </div>
          <div class="row">
            <div id="paginationView" class="span8">
            </div>
          </div>
        </div>
      </div>
    </script>

    <script id="diff-search-template" type="text/x-handlebars-template">
      <form class="form-search well">
        <fieldset>
          <div class="control-group">
            <input placeholder="Search..." type="text" name="search_string"
                   class="search-query input-large" value="{{search_string}}"/>
          </div>
          <div class="control-group">
            <select name="searcherUrl">
              {{#each searchers}}
              <option value="{{url}}" {{#if selected}}selected="selected"{{/if}}>{{name}}</option>
              {{/each}}
            </select>
          </div>
          <div class="control-group">
            <select name="searcherUrl2">
              {{#each searchers}}
              <option value="{{url}}" {{#if selected}}selected="selected"{{/if}}>{{name}}</option>
              {{/each}}
            </select>
          </div>          <div class="control-group">
            <input type="submit" style="width: 240px" class="btn btn-primary" name="search" value="Search!" data-loading-text="Searching..."/>
          </div>
          <hr/>
          <div>
            <div class="control-group">
              <div class="btn-group"  data-toggle="buttons-checkbox">
                <a rel="tooltip" title="search for products"
                   name="output_product" class="btn {{#if output_product}}active{{/if}}">product</a>
                <a rel="tooltip" title="search for offers"
                   name="output_offer" class="btn {{#if output_offer}}active{{/if}}">offer</a>
                <a rel="tooltip" title="search for didyoumean"
                   name="output_didyoumean" class="btn {{#if output_didyoumean}}active{{/if}}">didyoumean</a>
              </div>
            </div>
            <div class="control-group">
              <div class="btn-group"  data-toggle="buttons-checkbox">
                <a rel="tooltip" title="search for categories"
                   name="output_category" class="btn {{#if output_category}}active{{/if}}">category</a>
                <a rel="tooltip" title="search for theme pages"
                   name="output_theme_page" class="btn {{#if output_theme_page}}active{{/if}}">theme page</a>
                <a rel="tooltip" title="search for product variants"
                   name="output_product_variant" class="btn {{#if output_product_variant}}active{{/if}}">product variant</a>
              </div>
            </div>
            <div class="control-group">
              <div class="btn-group" data-toggle="buttons-checkbox">
                <a rel="tooltip" title="das hab ich immer noch nicht gerafft"
                   name="collect_filters" class="btn {{#if collect_filters}}active{{/if}}">filters
                </a>
                <a rel="tooltip" title="das auch nicht"
                   name="collect_filter_keys" class="btn {{#if collect_filter_keys}}active{{/if}}">filter keys
                </a>
                <a rel="tooltip" title="enable shop diversification"
                   name="shopdiv" class="btn {{#if shopdiv}}active{{/if}}">shopdiv
                </a>
                <a rel="tooltip" title="enable fuzzy"
                   name="fuzzy" class="btn {{#if fuzzy}}active{{/if}}">fuzzy
                </a>
              </div>
            </div>
            <div class="control-group">
              <select name="sort">
                <option value="relevance">relevance</option>
                <option value="rating">rating</option>
                <option value="clickout_relevance">clickout</option>
                <option value="min_price">min_price</option>
                <option value="price_rev">price_rev</option>
              </select>
            </div>

          </div>
        </fieldset>
      </form>
      <div class="progress progress-striped">
        <div class="bar"
             style="width: 0%;"></div>
      </div>
    </script>

    <script id="search-template" type="text/x-handlebars-template">
      <form class="form-search well">
        <fieldset>
          <div class="control-group">
            <input placeholder="Search..." type="text" name="search_string"
                   class="search-query input-large" value="{{search_string}}"/>
          </div>
          <div class="control-group">
            <select name="searcherUrl">
              {{#each searchers}}
              <option value="{{url}}" {{#if selected}}selected="selected"{{/if}}>{{name}}</option>
              {{/each}}
            </select>
          </div>
          <div class="control-group">
            <input type="submit" style="width: 240px" class="btn btn-primary" name="search" value="Search!" data-loading-text="Searching..."/>
          </div>
          <hr/>
          <div>
            <div class="control-group">
              <div class="btn-group"  data-toggle="buttons-checkbox">
                <a rel="tooltip" title="search for products"
                        name="output_product" class="btn {{#if output_product}}active{{/if}}">product</a>
                <a rel="tooltip" title="search for offers"
                        name="output_offer" class="btn {{#if output_offer}}active{{/if}}">offer</a>
                <a rel="tooltip" title="search for didyoumean"
                   name="output_didyoumean" class="btn {{#if output_didyoumean}}active{{/if}}">didyoumean</a>
              </div>
            </div>
            <div class="control-group">
              <div class="btn-group"  data-toggle="buttons-checkbox">
                <a rel="tooltip" title="search for categories"
                   name="output_category" class="btn {{#if output_category}}active{{/if}}">category</a>
                <a rel="tooltip" title="search for theme pages"
                   name="output_theme_page" class="btn {{#if output_theme_page}}active{{/if}}">theme page</a>
                <a rel="tooltip" title="search for product variants"
                   name="output_product_variant" class="btn {{#if output_product_variant}}active{{/if}}">product variant</a>
              </div>
            </div>
            <div class="control-group">
              <div class="btn-group" data-toggle="buttons-checkbox">
                <a rel="tooltip" title="das hab ich immer noch nicht gerafft"
                        name="collect_filters" class="btn {{#if collect_filters}}active{{/if}}">filters
                </a>
                <a rel="tooltip" title="das auch nicht"
                        name="collect_filter_keys" class="btn {{#if collect_filter_keys}}active{{/if}}">filter keys
                </a>
                <a rel="tooltip" title="enable shop diversification"
                        name="shopdiv" class="btn {{#if shopdiv}}active{{/if}}">shopdiv
                </a>
                <a rel="tooltip" title="enable fuzzy"
                   name="fuzzy" class="btn {{#if fuzzy}}active{{/if}}">fuzzy
                </a>
              </div>
            </div>
            <div class="control-group">
              <select name="sort">
                <option value="relevance">relevance</option>
                <option value="rating">rating</option>
                <option value="clickout_relevance">clickout</option>
                <option value="min_price">min_price</option>
                <option value="price_rev">price_rev</option>
              </select>
            </div>

          </div>
        </fieldset>
      </form>
      <div class="progress progress-striped">
        <div class="bar"
             style="width: 0%;"></div>
      </div>
    </script>

    <script id="filter-list-template" type="text/x-handlebars-template">
      <div class="btn-group">
      {{#each selectedFilters}}
      <a class="filter btn" style="margin-bottom: 5px" data-filter-id="{{key}}" data-value-id="{{value}}">{{keyName}}: {{valueName}}</a>
      {{/each}}
      </div>
    </script>
    
    <script id="filters-template" type="text/x-handlebars-template">
      <h2>Filters</h2>
      <ul class="nav nav-list">
      {{#each filters}}
        <li class="nav-header">{{keyName}} ({{count}})</li>
        {{#each values}}
        <li {{#if selected}}class="active"{{/if}}>
        <a data-filter-id="{{../key}}" data-value-id="{{value}}" class="filter" href="#">{{valueName}}
        ({{count}})</a></li>
        {{/each}}
        {{#if truncated}}
        <li>...</li>
        {{/if}}
      {{/each}}
      </ul>
    </script>

    <script id="results-template" type="text/x-handlebars-template">
      <div class="row">
        <div class="span8">
          <div class="page-header">
            <h1><a href="{{{searchUrl}}}&debug=1">Results</a></h1>
          </div>

          {{#if debug.queries}}
          <h3>Queries</h3>
          {{#each debug.queries}}
          <div><a data-toggle="collapse" href="#query-collapse-{{num}}">{{num}}. {{name}} ({{totalHits}} hits)</a></div>
          <div class="collapse" id="query-collapse-{{num}}">
            <p>
              <em>Query:</em>{{query}}<br/>
              <em>Filter:</em>{{filter}}<br/>
            </p>
          </div>
          {{/each}}
          {{/if}}

          {{#if debug.categoryQueries}}
          <h3>Category Queries</h3>
          {{#each debug.categoryQueries}}
          <div><a data-toggle="collapse" href="#categoryquery-collapse-{{num}}">{{num}}. {{name}} ({{totalHits}} hits)</a></div>
          <div class="collapse" id="categoryquery-collapse-{{num}}">
            <p>
              <em>Query:</em>{{query}}<br/>
              <em>Filter:</em>{{filter}}<br/>
            </p>
          </div>
          {{/each}}
          {{/if}}
          
          <p><br/></p>

          {{#if total_hits}}
          <table class="table table-bordered table-striped">
            <thead>
            <tr>
              <th>type</th>
              <th>id</th>
              <th>name</th>
              <th>category</th>
              <th>brand</th>
              <th>shop</th>
              <th>score</th>
            </tr>
            </thead>
            <tbody>
            {{#each hits}}
            <tr>
              <td>{{type}}</td>
              <td>{{id}}</td>
              <td><a href="#explain-{{docid}}" class="collapser" data-toggle="collapse">{{name}}</a></td>
              <td>{{category}}</td>
              <td>{{brand}}</td>
              <td>{{shop}}</td>
              <td>{{score}}</td>
            </tr>
            <tr>
              <td colspan="7"><div id="explain-{{docid}}" class="collapse">{{{explanation}}}</div></td>
            </tr>
            {{/each}}
            </tbody>
          </table>
          Total hits: {{total_hits}}
          {{else}}
          No search hits.
          {{/if}}

        </div>
      </div>
    </script>
    
    <script id="results-pagination-template" type="text/x-handlebars-template">
      <div class="pagination" align="center">
        {{#if hasHits}}
        <ul>
          <li {{#unless hasPrevious}}class="disabled"{{/unless}}><a data-page="{{prevPage}}" href="#">←</a></li>
          {{#each pages}}
          {{#if isPlaceHolder}}
          <li class="disabled"><a href="#">...</a></li>
          {{else}}
          <li {{#if isSelected}}class="active"{{/if}}><a href="#" data-page="{{num}}">{{num}}</a></li>
          {{/if}}
          {{/each}}
          <li {{#unless hasNext}}class="disabled"{{/unless}}><a href="#" data-page="{{nextPage}}">→</a></li>
        </ul>
        {{/if}}
      </div>
    </script>
    
    <script id="compare-results-template" type="text/x-handlebars-template">
      <h2>Visual diff</h2>
      {{#if diffHtml}}
      Diff between
      <ul>
        <li><a href="{{{s1}}}">{{q1.searcherUrl}}</a></li>
        <li><a href="{{{s2}}}">{{q2.searcherUrl}}</a></li>
      </ul>
      <div class="jsondiffpatch-visualdiff-root">
        {{{diffHtml}}}
      </div>
      {{else}}
      No Diff yet!
      {{/if}}
    </script>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/vendor/jquery-1.7.1.js"></script>
    <script src="js/vendor/underscore.js"></script>
    <script src="js/vendor/backbone.js"></script>
    <script src="js/vendor/json2.js"></script>
    <script src="js/vendor/handlebars.js"></script>
    <script src="js/vendor/backbone.marionette.js"></script>
    <script src="js/vendor/backbone.modelbinding.js"></script>
    <script src="js/vendor/bootstrap-transition.js"></script>
    <script src="js/vendor/bootstrap-alert.js"></script>
    <script src="js/vendor/bootstrap-modal.js"></script>
    <script src="js/vendor/bootstrap-dropdown.js"></script>
    <script src="js/vendor/bootstrap-scrollspy.js"></script>
    <script src="js/vendor/bootstrap-tab.js"></script>
    <script src="js/vendor/bootstrap-tooltip.js"></script>
    <script src="js/vendor/bootstrap-popover.js"></script>
    <script src="js/vendor/bootstrap-button.js"></script>
    <script src="js/vendor/bootstrap-collapse.js"></script>
    <script src="js/vendor/bootstrap-carousel.js"></script>
    <script src="js/vendor/bootstrap-typeahead.js"></script>

    <script src="js/vendor/require.js" data-main="js/main"></script>

  </body>
</html>
